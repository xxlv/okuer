<!DOCTYPE html>
<html lang="en">
  <head>
    <title>
  Go with wasm · Okuer
</title>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="ghost">
<meta name="description" content="以下内容基于chaptGPT,文中的代码示例经过验证和修订
WASM Link to heading WebAssembly（缩写为 wasm）是一种低级的、面向栈的虚拟机，用于在现代 Web 浏览器中执行二进制代码。它被设计成一个可移植、高效和安全的执行环境，可以被用于许多不同的场景，包括：
在 Web 浏览器中提供比 JavaScript 更高效的编程语言。wasm 可以使得高性能的编程语言如 C/C&#43;&#43;、Rust 和 Go 等运行在 Web 平台上，从而为 Web 应用提供更快的执行速度和更好的用户体验。
在 Web 应用中使用第三方库。由于 wasm 的二进制格式可以被多种语言所编译生成，因此可以在 Web 应用中使用其他语言编写的库，而不需要对库的源代码进行修改。
跨平台开发。wasm 可以在多个平台上运行，因此可以在不同的硬件和操作系统上共享代码，简化跨平台开发的难度和成本。
In Go Link to heading Go 语言的 WebAssembly（wasm）支持允许开发人员编写 Go 语言代码，并将其编译为 wasm 模块，以便在 Web 平台上运行。Go 语言的 wasm 支持是 Go 1.11 版本中引入的，并在后续版本中得到了进一步的改进和优化。
使用 Go 语言的 wasm 支持，可以将现有的 Go 语言代码直接编译为 wasm 模块，然后在 Web 平台上运行。这为开发人员提供了许多好处，包括：
更高的性能。由于 wasm 是一种比 JavaScript 更低级别的虚拟机，因此可以提供更高的性能和更低的内存消耗。
更好的安全性。由于 wasm 运行在 Web 浏览器的安全沙箱中，因此可以提供更好的安全性，避免 Web 应用被恶意代码攻击。">
<meta name="keywords" content="blog,developer,personal">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Go with wasm"/>
<meta name="twitter:description" content="以下内容基于chaptGPT,文中的代码示例经过验证和修订
WASM Link to heading WebAssembly（缩写为 wasm）是一种低级的、面向栈的虚拟机，用于在现代 Web 浏览器中执行二进制代码。它被设计成一个可移植、高效和安全的执行环境，可以被用于许多不同的场景，包括：
在 Web 浏览器中提供比 JavaScript 更高效的编程语言。wasm 可以使得高性能的编程语言如 C/C&#43;&#43;、Rust 和 Go 等运行在 Web 平台上，从而为 Web 应用提供更快的执行速度和更好的用户体验。
在 Web 应用中使用第三方库。由于 wasm 的二进制格式可以被多种语言所编译生成，因此可以在 Web 应用中使用其他语言编写的库，而不需要对库的源代码进行修改。
跨平台开发。wasm 可以在多个平台上运行，因此可以在不同的硬件和操作系统上共享代码，简化跨平台开发的难度和成本。
In Go Link to heading Go 语言的 WebAssembly（wasm）支持允许开发人员编写 Go 语言代码，并将其编译为 wasm 模块，以便在 Web 平台上运行。Go 语言的 wasm 支持是 Go 1.11 版本中引入的，并在后续版本中得到了进一步的改进和优化。
使用 Go 语言的 wasm 支持，可以将现有的 Go 语言代码直接编译为 wasm 模块，然后在 Web 平台上运行。这为开发人员提供了许多好处，包括：
更高的性能。由于 wasm 是一种比 JavaScript 更低级别的虚拟机，因此可以提供更高的性能和更低的内存消耗。
更好的安全性。由于 wasm 运行在 Web 浏览器的安全沙箱中，因此可以提供更好的安全性，避免 Web 应用被恶意代码攻击。"/>

<meta property="og:title" content="Go with wasm" />
<meta property="og:description" content="以下内容基于chaptGPT,文中的代码示例经过验证和修订
WASM Link to heading WebAssembly（缩写为 wasm）是一种低级的、面向栈的虚拟机，用于在现代 Web 浏览器中执行二进制代码。它被设计成一个可移植、高效和安全的执行环境，可以被用于许多不同的场景，包括：
在 Web 浏览器中提供比 JavaScript 更高效的编程语言。wasm 可以使得高性能的编程语言如 C/C&#43;&#43;、Rust 和 Go 等运行在 Web 平台上，从而为 Web 应用提供更快的执行速度和更好的用户体验。
在 Web 应用中使用第三方库。由于 wasm 的二进制格式可以被多种语言所编译生成，因此可以在 Web 应用中使用其他语言编写的库，而不需要对库的源代码进行修改。
跨平台开发。wasm 可以在多个平台上运行，因此可以在不同的硬件和操作系统上共享代码，简化跨平台开发的难度和成本。
In Go Link to heading Go 语言的 WebAssembly（wasm）支持允许开发人员编写 Go 语言代码，并将其编译为 wasm 模块，以便在 Web 平台上运行。Go 语言的 wasm 支持是 Go 1.11 版本中引入的，并在后续版本中得到了进一步的改进和优化。
使用 Go 语言的 wasm 支持，可以将现有的 Go 语言代码直接编译为 wasm 模块，然后在 Web 平台上运行。这为开发人员提供了许多好处，包括：
更高的性能。由于 wasm 是一种比 JavaScript 更低级别的虚拟机，因此可以提供更高的性能和更低的内存消耗。
更好的安全性。由于 wasm 运行在 Web 浏览器的安全沙箱中，因此可以提供更好的安全性，避免 Web 应用被恶意代码攻击。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.okuer.com/go/go-with-wasm/" /><meta property="article:section" content="go" />
<meta property="article:published_time" content="2023-02-21T11:52:51+08:00" />
<meta property="article:modified_time" content="2023-02-21T11:52:51+08:00" />




<link rel="canonical" href="https://blog.okuer.com/go/go-with-wasm/">


<link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.min.0fa2dc75ed1b76894ac0e062b10a6c4730daa745096fa120114b290ed8a48788.css" integrity="sha256-D6Lcde0bdolKwOBisQpsRzDap0UJb6EgEUspDtikh4g=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.min.593028e7f7ac55c003b79c230d1cd411bb4ca53b31556c3abb7f027170e646e9.css" integrity="sha256-WTAo5/esVcADt5wjDRzUEbtMpTsxVWw6u38CcXDmRuk=" crossorigin="anonymous" media="screen" />
  



 




<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">




<meta name="generator" content="Hugo 0.110.0">





  </head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      Okuer
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/posts">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/go">Go</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/project">Projects</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/about/">About</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container page">
  <article>
    <header>
      <h1 class="title">
        <a class="title-link" href="https://blog.okuer.com/go/go-with-wasm/">
          Go with wasm
        </a>
      </h1>
    </header>

    <p>以下内容基于chaptGPT,文中的代码示例经过验证和修订</p>
<h1 id="wasm">
  WASM
  <a class="heading-link" href="#wasm">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p>WebAssembly（缩写为 wasm）是一种低级的、面向栈的虚拟机，用于在现代 Web 浏览器中执行二进制代码。它被设计成一个可移植、高效和安全的执行环境，可以被用于许多不同的场景，包括：</p>
<p>在 Web 浏览器中提供比 JavaScript 更高效的编程语言。wasm 可以使得高性能的编程语言如 C/C++、Rust 和 Go 等运行在 Web 平台上，从而为 Web 应用提供更快的执行速度和更好的用户体验。</p>
<p>在 Web 应用中使用第三方库。由于 wasm 的二进制格式可以被多种语言所编译生成，因此可以在 Web 应用中使用其他语言编写的库，而不需要对库的源代码进行修改。</p>
<p>跨平台开发。wasm 可以在多个平台上运行，因此可以在不同的硬件和操作系统上共享代码，简化跨平台开发的难度和成本。</p>
<h1 id="in-go">
  In Go
  <a class="heading-link" href="#in-go">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p>Go 语言的 WebAssembly（wasm）支持允许开发人员编写 Go 语言代码，并将其编译为 wasm 模块，以便在 Web 平台上运行。Go 语言的 wasm 支持是 Go 1.11 版本中引入的，并在后续版本中得到了进一步的改进和优化。</p>
<p>使用 Go 语言的 wasm 支持，可以将现有的 Go 语言代码直接编译为 wasm 模块，然后在 Web 平台上运行。这为开发人员提供了许多好处，包括：</p>
<p>更高的性能。由于 wasm 是一种比 JavaScript 更低级别的虚拟机，因此可以提供更高的性能和更低的内存消耗。</p>
<p>更好的安全性。由于 wasm 运行在 Web 浏览器的安全沙箱中，因此可以提供更好的安全性，避免 Web 应用被恶意代码攻击。</p>
<p>更高的可移植性。由于 wasm 的二进制格式可以在多个平台上运行，因此可以使得 Go 语言代码在不同的平台上共享，从而简化了跨平台开发的难度。</p>
<h1 id="demo">
  Demo
  <a class="heading-link" href="#demo">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<h2 id="原生go">
  原生go
  <a class="heading-link" href="#%e5%8e%9f%e7%94%9fgo">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<h3 id="code">
  code
  <a class="heading-link" href="#code">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="font-weight:bold">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="font-style:italic">&#34;syscall/js&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">func</span> Add(his js.Value, args []js.Value) any {
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">return</span> <span style="font-style:italic">&#34;ok &#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">func</span> main() {
</span></span><span style="display:flex;"><span>	alert := js.Global().Get(<span style="font-style:italic">&#34;alert&#34;</span>)
</span></span><span style="display:flex;"><span>    js.Global().Set(<span style="font-style:italic">&#34;Add&#34;</span>, js.FuncOf(Add))
</span></span><span style="display:flex;"><span>	alert.Invoke(<span style="font-style:italic">&#34;Hello World!&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	&lt;-make(<span style="font-weight:bold">chan</span> <span style="">int</span>, 0)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>注意  js.Global().Set(&ldquo;Add&rdquo;,js.FuncOf(Add)) 这里是需要将go的方法注册到js中</p>
</blockquote>
<h3 id="编译成为wasm">
  编译成为wasm
  <a class="heading-link" href="#%e7%bc%96%e8%af%91%e6%88%90%e4%b8%bawasm">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p><code>GOOS=js GOARCH=wasm go build -o add.wasm</code></p>
<h3 id="js调用">
  js调用
  <a class="heading-link" href="#js%e8%b0%83%e7%94%a8">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<blockquote>
<p>wasm_exec.js 位于 <code>$GOROOT/misc/wasm/wasm_exec.js</code> 属于js 补丁</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>	&lt;script src=<span style="font-style:italic">&#34;wasm_exec.js&#34;</span>&gt;&lt;<span style="">/script&gt;</span>
</span></span><span style="display:flex;"><span>	&lt;script&gt;
</span></span><span style="display:flex;"><span>		<span style="font-weight:bold">if</span> (!WebAssembly.instantiateStreaming) { <span style="font-style:italic">// polyfill
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>			WebAssembly.instantiateStreaming = <span style="font-weight:bold">async</span> (resp, importObject) =&gt; {
</span></span><span style="display:flex;"><span>				<span style="font-weight:bold">const</span> source = <span style="font-weight:bold">await</span> (<span style="font-weight:bold">await</span> resp).arrayBuffer();
</span></span><span style="display:flex;"><span>				<span style="font-weight:bold">return</span> <span style="font-weight:bold">await</span> WebAssembly.instantiate(source, importObject);
</span></span><span style="display:flex;"><span>			};
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="font-weight:bold">const</span> go = <span style="font-weight:bold">new</span> Go();
</span></span><span style="display:flex;"><span>		<span style="font-weight:bold">let</span> mod, inst;
</span></span><span style="display:flex;"><span>		WebAssembly.instantiateStreaming(fetch(<span style="font-style:italic">&#34;add.wasm&#34;</span>), go.importObject).then((result) =&gt; {
</span></span><span style="display:flex;"><span>			mod = result.module;
</span></span><span style="display:flex;"><span>			inst = result.instance;
</span></span><span style="display:flex;"><span>			document.getElementById(<span style="font-style:italic">&#34;runButton&#34;</span>).disabled = <span style="font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>		}).<span style="font-weight:bold">catch</span>((err) =&gt; {
</span></span><span style="display:flex;"><span>			console.error(err);
</span></span><span style="display:flex;"><span>		});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="font-weight:bold">async</span> <span style="font-weight:bold">function</span> run() {
</span></span><span style="display:flex;"><span>			console.clear();
</span></span><span style="display:flex;"><span>			<span style="font-weight:bold">await</span> go.run(inst);
</span></span><span style="display:flex;"><span>			inst = <span style="font-weight:bold">await</span> WebAssembly.instantiate(mod, go.importObject); <span style="font-style:italic">// reset instance
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	&lt;<span style="">/script&gt;</span>
</span></span></code></pre></div><h2 id="tinygo">
  tinygo
  <a class="heading-link" href="#tinygo">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p><code>brew tap tinygo-org/tools &amp;&amp; brew install tinygo</code></p>
<h3 id="code-1">
  code
  <a class="heading-link" href="#code-1">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="font-weight:bold">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-style:italic">// This calls a JS function from Go.
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span><span style="font-weight:bold">func</span> main() {
</span></span><span style="display:flex;"><span>    println(<span style="font-style:italic">&#34;adding two numbers:&#34;</span>, add(2, 3)) <span style="font-style:italic">// expecting 5
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-style:italic">// This function is imported from JavaScript, as it doesn&#39;t define a body.
</span></span></span><span style="display:flex;"><span><span style="font-style:italic">// You should define a function named &#39;add&#39; in the WebAssembly &#39;env&#39;
</span></span></span><span style="display:flex;"><span><span style="font-style:italic">// module from JavaScript.
</span></span></span><span style="display:flex;"><span><span style="font-style:italic">//
</span></span></span><span style="display:flex;"><span><span style="font-style:italic">//export add
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span><span style="font-weight:bold">func</span> add(x, y <span style="">int</span>) <span style="">int</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-style:italic">// This function is exported to JavaScript, so can be called using
</span></span></span><span style="display:flex;"><span><span style="font-style:italic">// exports.multiply() in JavaScript.
</span></span></span><span style="display:flex;"><span><span style="font-style:italic">//export multiply
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span><span style="font-weight:bold">func</span> multiply(x, y <span style="">int</span>) <span style="">int</span> {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">return</span> x * y;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="运行">
  运行
  <a class="heading-link" href="#%e8%bf%90%e8%a1%8c">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p><code>tinygo build -o wasm.wasm -target wasm ./main.go</code></p>
<blockquote>
<p>注意 需要执行 <code>cp $(tinygo env TINYGOROOT)/targets/wasm_exec.js .</code> 来下载tinygo的 wasm_exec.js</p>
</blockquote>
<h3 id="js-访问">
  js 访问
  <a class="heading-link" href="#js-%e8%ae%bf%e9%97%ae">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>instance.exports.multiply()
</span></span></code></pre></div><h3 id="tinygo-特色">
  tinygo 特色
  <a class="heading-link" href="#tinygo-%e7%89%b9%e8%89%b2">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>TinyGo 是一种针对嵌入式设备的 Go 编译器，它可以将 Go 代码编译成非常小的、快速运行的二进制文件，以适应嵌入式设备的资源限制。以下是一些 TinyGo 的场景：</p>
<p>物联网设备：由于嵌入式设备通常具有较小的存储和内存，TinyGo 可以帮助将 Go 代码编译为更小、更快的二进制文件，以满足 IoT 设备的资源限制。</p>
<p>机器人和无人机：TinyGo 可以使机器人和无人机的控制系统更加灵活和可靠，提高其自主决策和反应速度。</p>
<p>传感器：TinyGo 可以编写用于读取和处理传感器数据的代码，并将其编译为小型二进制文件，以在资源受限的设备上运行。</p>
<p>嵌入式系统：TinyGo 也可用于构建嵌入式系统的固件和驱动程序，从而提高系统的效率和可靠性。</p>
<p>游戏控制器：TinyGo 可以用于编写游戏控制器代码，以实现更快的响应时间和更低的延迟，从而提高游戏体验。</p>
<h2 id="差异">
  差异
  <a class="heading-link" href="#%e5%b7%ae%e5%bc%82">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>tinygo 生成的wasm提交较小,推荐用<code>tinygo</code></p>

  </article>
</section>

  

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      2014 -
    
    2023
     ghost 
    ·
    
    Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
